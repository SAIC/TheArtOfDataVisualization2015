Table table = new Table();

table.addColumn("violationNumber");
table.addColumn("violationTitle");
table.addColumn("violationComment");

// Taken from Inspection ID 1522456

// This is our raw violation entry that we want to break apart into chunks.
String rawViolation = "11. ADEQUATE NUMBER, CONVENIENT, ACCESSIBLE, DESIGNED, AND MAINTAINED - Comments: FOUND NO HOT RUNNING WATER IN MENS WASHROOM AT THE HANDSINK AND NO COLD RUNNING WATER AT THE EXPOSED HANDSINK IN THE PREP AREA; MUST RESTORE HOT/COLD RUNNING WATER AT BOTH SINKS. CRITICAL VIOLATION 7-38-030 ISSUED. | 13. NO EVIDENCE OF RODENT OR INSECT INFESTATION, NO BIRDS, TURTLES OR OTHER ANIMALS - Comments: FOUND RODENT (MICE) INFESTATION IN STORE.  OVER 500 DROPPINGS OBSERVED UNDER SHELVES IN THE STORAGE AREA, ON FLOOR BEHIND ICE CREAM FREEZER, ON FLOOR IN PREP AREA UNDER PREP TABLES, AND ON COUNTER DISPLAY. FOUND 500 DROPPINGS ON FLOOR OF WALK-IN COOLER USED FOR STORAGE LOCATED BETWEEN THE RESTAURANT AND STORE; MUST CLEAN AND REMOVE CLUTTER OF ITEMS.  MUST CLEAN ALL AFFECTED AREAS AND HAVE PEST CONTROL COMPANY SERVICE ESTABLISHMENT. FRONT ENTRANCE DOOR NOT RODENT PROOFED; MUST RODENT PROOF FRONT ENTRANCE DOOR TO SEAL THE 1/2 INCH GAP OBSERVED. CRITICAL VIOLATION 7-38-020 ISSUED. | 10. SEWAGE AND WASTE WATER DISPOSAL, NO BACK SIPHONAGE, CROSS  CONNECTION AND/OR BACK FLOW - Comments: OBSERVED WASTE WATER PROFUSELY LEAKING FROM THE MOP SINK DRAIN PIPE WHEN SINK IS RUNNING; MUST REPAIR TO AVOID WASTE WATER RUNNING ONTO THE FLOOR. CRITICAL VIOLATION ISSUED 7-38-030. | 16. FOOD PROTECTED DURING STORAGE, PREPARATION, DISPLAY, SERVICE AND TRANSPORTATION - Comments: OBSERVED FOODS NOT PROTECTED AS REQUIRED DURING STORAGE.  RAW BEEF AND RAW CHICKEN OBSERVED IN DISPLAY COOLER ABOVE LETTUCE; INSTRUCTED TO STORE RAW MEATS AND PRODUCE IN SEPERATE AREAS OF COOLER. OBSERVED SEVERAL FOOD ITEMS IN THE WALK IN FREEZER NOT PROTECTED:  RAW BEEF AND RIBS STORED WITH READY TO EAT FOODS, MEATS AND OTHER ITEMS STORED ON TOP OF ONE ANOTHER WITH NO SHELVING IN UNIT TO SEPERATE OR ELEVATE ITEMS FOR PROPER STORAGE. SERIOUS VIOLATION ISSUED 7-38-005(A). | 19. OUTSIDE GARBAGE WASTE GREASE AND STORAGE AREA; CLEAN, RODENT PROOF, ALL CONTAINERS COVERED - Comments: OBSERVED THE OUTSIDE DISPOSAL AND YARD AREA NOT MAINTAINED AS REQUIRED.  FOUND AN UNUSED BANDSAW, FREEZER, TOILET, COOLER, CARPET AND SHELVING OUTSIDE IN THE DISPOSAL AREA.  INSTRUCTED THAT THESE ITEMS MUST BE REMOVED TO PREVENT RODENT HARBORAGE AND CLUTTER IN THE DISPOSAL AREA. SERIOUS VIOLATION ISSUED 7-38-020. | 34. FLOORS: CONSTRUCTED PER CODE, CLEANED, GOOD REPAIR, COVING INSTALLED, DUST-LESS CLEANING METHODS USED - Comments: OBSERVED SOME MISSING FLOOR TILE IN THE REAR AREA IN FRONT OF WOMENS WASHROOM; REPLACE TILE. CLEAN FLOORS THROUGHOUT STORE IN AFFECTED AREAS UNDER AROUND AND BEHIND VARIOUS EQUIPMENT. | 35. WALLS, CEILINGS, ATTACHED EQUIPMENT CONSTRUCTED PER CODE: GOOD REPAIR, SURFACES CLEAN AND DUST-LESS CLEANING METHODS - Comments: MUST SEAL OPENINGS IN WALLS IN PREP AND STORAGE AREAS AND REPLACE MISSING WALLBASE FOUND IN POOR REPAIR IN PREP ANMD STORAGE AREAS. | 38. VENTILATION: ROOMS AND EQUIPMENT VENTED AS REQUIRED: PLUMBING: INSTALLED AND MAINTAINED - Comments: THE EXPOSED HANDSINK IN THE PREP AREA IS LEAKING FROM THE PIPE UNDERNEATH; REPAIR LEAK. NO BACK FLOW DEVICE AT THE ICE MACHINE IN REAR AREA; MUST INSTALL A BACKFLOW DEVICE AT ICE MACHINE OR SHOW PROOF THAT A DEVICE IS INSTALLED ON THE PLUMBING LINE. VENTILATION NOT WORKING IN EITHER WASHROOM. MUST REPAIR AND MAINTAIN VENTILATION. | 41. PREMISES MAINTAINED FREE OF LITTER, UNNECESSARY ARTICLES, CLEANING  EQUIPMENT PROPERLY STORED - Comments: FOUND EXCESSIVE CLUTTER IN THE WALK-IN COOLER LOCATED BETWEEN THE RESTAURANT AT 5448 AND STORE AT 5450; MUST REMOVE CLUTTER (OLD EQUIPMENT, TOILET BOXES ETC).  | 33. FOOD AND NON-FOOD CONTACT EQUIPMENT UTENSILS CLEAN, FREE OF ABRASIVE DETERGENTS - Comments: STORAGE SHELVES NOT CLEAN. MUST CLEAN AND MAINTAIN SHELVES. | 32. FOOD AND NON-FOOD CONTACT SURFACES PROPERLY DESIGNED, CONSTRUCTED AND MAINTAINED - Comments: DARK STAINS AND OPEN SEAMS ON CUTTING BOARDS. MUST REMOVE OR REPLACE CUTTING BOARDS.";

// Split our violations into lines representing each violation.
String[] violations = split(rawViolation, "|");

// Iterate through the violation lines one by one ...
for (String violation : violations)
{
  // Trim the violation ...
  String trimmedViolation = trim(violation);

  // Split the trimmed violation at the "- Comments: " string. 
  String[] violationAndComment = split(trimmedViolation, "- Comments:");
  
  // Check to see if we got 2 parts (a violation and a comment).
  if (violationAndComment.length == 2)
  {
     // Trim both parts and make them into their own variables.
     String violationPart = trim(violationAndComment[0]);
     String commentPart = trim(violationAndComment[1]);
     
     // Find the index of the period.
     int indexOfPeriod = violationPart.indexOf(".");

     String violationNumber = trim(violationPart.substring(0, indexOfPeriod));
     String violationTitle = trim(violationPart.substring(indexOfPeriod + 1));
 
     // If we want to ...    
     int violationNumberInt = int(violationNumber); // Turn string into number.
   
     println("Violation Number: " + violationNumber);
     println(" Violation Title: " + violationTitle);
     println("         Comment: " + commentPart);
     println("");
     
     TableRow newRow = table.addRow();

     newRow.setInt("violationNumber", violationNumberInt);
     newRow.setString("violationTitle", violationTitle);
     newRow.setString("violationComment", commentPart);
  }
  else 
  {
     println("Something happened that was not expected ..."); 
  }
}


saveTable(table, "data/ViolationTable.csv");

